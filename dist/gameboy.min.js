var GameboyJS;!function(o){"use strict";function r(t){this.gameboy=t,this.r={A:0,F:0,B:0,C:0,D:0,E:0,H:0,L:0,pc:0,sp:0},this.IME=!0,this.clock={c:0,serial:0},this.isHalted=!1,this.isPaused=!1,this.usingBootRom=!1,this.createDevices()}r.INTERRUPTS={VBLANK:0,LCDC:1,TIMER:2,SERIAL:3,HILO:4},r.interruptRoutines={0:function(t){o.cpuOps.RSTn(t,64)},1:function(t){o.cpuOps.RSTn(t,72)},2:function(t){o.cpuOps.RSTn(t,80)},3:function(t){o.cpuOps.RSTn(t,88)},4:function(t){o.cpuOps.RSTn(t,96)}},r.prototype.createDevices=function(){this.memory=new o.Memory(this),this.timer=new o.Timer(this,this.memory),this.apu=new o.APU(this.memory),this.SERIAL_INTERNAL_INSTR=512,this.enableSerial=0,this.serialHandler=o.ConsoleSerial},r.prototype.reset=function(){this.memory.reset(),this.r.sp=65534},r.prototype.loadRom=function(t){this.memory.setRomData(t)},r.prototype.getRamSize=function(){var t=0;switch(this.memory.rb(329)){case 1:t=2048;break;case 2:t=8192;break;case 3:t=32768}return t},r.prototype.getGameName=function(){for(var t="",n=308;n<323;n++){var r=this.memory.rb(n)||32;t+=String.fromCharCode(r)}return t},r.prototype.run=function(){this.usingBootRom?this.r.pc=0:this.r.pc=256,this.frame()},r.prototype.stop=function(){clearTimeout(this.nextFrameTimer)},r.prototype.frame=function(){this.isPaused||(this.nextFrameTimer=setTimeout(this.frame.bind(this),1e3/o.Screen.physics.FREQUENCY));try{for(var t=!1;!t;){var n,r,i=this.clock.c,e=(this.isHalted?this.clock.c+=4:(n=this.fetchOpcode(),o.opcodeMap[n](this),this.r.F&=240,this.enableSerial&&(r=this.clock.c-i,this.clock.serial+=r,this.clock.serial>=8*this.SERIAL_INTERNAL_INSTR)&&this.endSerialTransfer()),this.clock.c-i),t=this.gpu.update(e);this.timer.update(e),this.input.update(),this.apu.update(e),this.checkInterrupt()}this.clock.c=0}catch(t){this.gameboy.handleException(t)}},r.prototype.fetchOpcode=function(){var t=this.memory.rb(this.r.pc++);if(void 0!==t)return o.opcodeMap[t]?t:(console.error("Unknown opcode "+t.toString(16)+" at address "+(this.r.pc-1).toString(16)+", stopping execution..."),this.stop(),null);console.log(t+" at "+(this.r.pc-1).toString(16)),this.stop()},r.prototype.rr=function(t){return this.r[t]},r.prototype.wr=function(t,n){this.r[t]=n},r.prototype.halt=function(){this.isHalted=!0},r.prototype.unhalt=function(){this.isHalted=!1},r.prototype.pause=function(){this.isPaused=!0},r.prototype.unpause=function(){this.isPaused&&(this.isPaused=!1,this.frame())},r.prototype.checkInterrupt=function(){if(this.IME)for(var t=0;t<5;t++){var n=this.memory.rb(65295);if(o.Util.readBit(n,t)&&this.isInterruptEnable(t)){n&=255-(1<<t),this.memory.wb(65295,n),this.disableInterrupts(),this.clock.c+=4,r.interruptRoutines[t](this);break}}},r.prototype.requestInterrupt=function(t){var n=this.memory.rb(65295);this.memory.wb(65295,n|=1<<t),this.unhalt()},r.prototype.isInterruptEnable=function(t){return 0!=o.Util.readBit(this.memory.rb(65535),t)},r.prototype.enableInterrupts=function(){this.IME=!0},r.prototype.disableInterrupts=function(){this.IME=!1},r.prototype.enableSerialTransfer=function(){this.enableSerial=1,this.clock.serial=0},r.prototype.endSerialTransfer=function(){this.enableSerial=0;var t=this.memory.rb(65281);this.memory.wb(65282,0),this.serialHandler.out(t),this.memory.wb(65281,this.serialHandler.in())},r.prototype.resetDivTimer=function(){this.timer.resetDiv()},o.CPU=r}(GameboyJS=GameboyJS||{}),function(p){"use strict";var t={view_memory:function(t,n){for(var r=n.cpu.memory,i=(t&=65520).toString(16)+":",e=t;e<t+16;e++){0==(1&e)&&(i+=" ");var o=(o=r[e]||0).toString(16);i+="00".substring(o.length)+o}return i},view_tile:function(t,n,r){t.cpu.memory;for(var t=t.screen,i=t.deviceram(t.LCDC),e=(void 0===r&&(r=32768,p.Util.readBit(i,4)||(r=34816,n=p.cpuOps._getSignedValue(n)+128)),t.readTileData(n,r)),o=new Array(64),c=0;c<8;c++)for(var s=e.shift(),a=e.shift(),u=0;u<8;u++){var f=1<<7-u;o[8*c+u]=((s&f)>>7-u)+2*((a&f)>>7-u)}for(var h=0;o.length;)console.log(h+++" "+o.splice(0,8).join(""))},list_visible_sprites:function(t){for(var n=t.cpu.memory,r=new Array,i=65024;i<65183;i+=4){var e=n.oamram(i+1),o=n.oamram(i),c=n.oamram(i+2);0==e||168<=e||r.push({oamIndex:i,x:e,y:o,tileIndex:c})}return r}};p.Debug=t}(GameboyJS=GameboyJS||{}),function(L){"use strict";function p(t,n){this.cpu=n,this.screen=t,this.LCDC=65344,this.STAT=65345,this.SCY=65346,this.SCX=65347,this.LY=65348,this.LYC=65349,this.BGP=65351,this.OBP0=65352,this.OBP1=65353,this.WY=65354,this.WX=65355,this.vram=n.memory.vram.bind(n.memory),this.OAM_START=65024,this.OAM_END=65183,this.deviceram=n.memory.deviceram.bind(n.memory),this.oamram=n.memory.oamram.bind(n.memory),this.VBLANK_TIME=70224,this.clock=0,this.mode=2,this.line=0,R=L.Screen,this.buffer=new Array(R.physics.WIDTH*R.physics.HEIGHT),this.tileBuffer=new Array(8),this.bgTileCache={}}var R;p.tilemap={HEIGHT:32,WIDTH:32,START_0:38912,START_1:39936,LENGTH:1024},p.prototype.update=function(t){this.clock+=t;var n=!1;switch(this.mode){case 0:204<=this.clock&&(this.clock-=204,this.line++,this.updateLY(),144==this.line?(this.setMode(1),n=!0,this.cpu.requestInterrupt(L.CPU.INTERRUPTS.VBLANK),this.drawFrame()):this.setMode(2));break;case 1:456<=this.clock&&(this.clock-=456,this.line++,153<this.line&&(this.line=0,this.setMode(2)),this.updateLY());break;case 2:80<=this.clock&&(this.clock-=80,this.setMode(3));break;case 3:172<=this.clock&&(this.clock-=172,this.drawScanLine(this.line),this.setMode(0))}return n},p.prototype.updateLY=function(){this.deviceram(this.LY,this.line);var t=this.deviceram(this.STAT);this.deviceram(this.LY)==this.deviceram(this.LYC)?(this.deviceram(this.STAT,4|t),64&t&&this.cpu.requestInterrupt(L.CPU.INTERRUPTS.LCDC)):this.deviceram(this.STAT,251&t)},p.prototype.setMode=function(t){this.mode=t;var n=this.deviceram(this.STAT);this.deviceram(this.STAT,n=n&252|t),t<3&&n&1<<3+t&&this.cpu.requestInterrupt(L.CPU.INTERRUPTS.LCDC)},p.prototype.drawScanLine=function(t){var n,r=this.deviceram(this.LCDC);L.Util.readBit(r,7)&&(n=new Array(R.physics.WIDTH),this.drawBackground(r,t,n),this.drawSprites(r,t,n))},p.prototype.drawFrame=function(){var t=this.deviceram(this.LCDC);L.Util.readBit(t,7)&&this.drawWindow(t),this.bgTileCache={},this.screen.render(this.buffer)},p.prototype.drawBackground=function(t,n,r){if(L.Util.readBit(t,0)){for(var i,e=L.Util.readBit(t,3)?p.tilemap.START_1:p.tilemap.START_0,o=!1,t=(L.Util.readBit(t,4)?i=32768:(i=34816,o=!0),this.deviceram(this.SCX)),c=this.deviceram(this.SCY),s=n+c&7,c=(t/8|0)+32*(31&((c+n)/8|0)),a=c+R.physics.WIDTH/8+1,u=((31&a)<(31&c)&&(a-=32),8*(31&c)-t),f=c;f!=a;0==(31&++f)&&(f-=32)){var h=this.vram(f+e),h=(o&&(h=L.Util.getSignedValue(h)+128),this.bgTileCache[h]||(this.bgTileCache[h]=this.readTileData(h,i)));this.drawTileLine(h,s),this.copyBGTileLine(r,this.tileBuffer,u),u+=8}this.copyLineToBuffer(r,n)}},p.prototype.copyBGTileLine=function(t,n,r){for(var i=0;i<8;i++,r++)r<0||r>=R.physics.WIDTH||(t[r]=n[i])},p.prototype.copyLineToBuffer=function(t,n){for(var r=p.getPalette(this.deviceram(this.BGP)),i=0;i<R.physics.WIDTH;i++){var e=t[i];this.drawPixel(i,n,r[e])}},p.prototype.drawTileLine=function(t,n,r,i){r|=0;for(var i=2*((i|=0)?7-n:n),e=t[i++],o=t[+i],c=8,s=0;s<8;s++){var a=1<<--c;this.tileBuffer[r?c:s]=((e&a)>>c)+2*((o&a)>>c)}},p.prototype.drawSprites=function(t,n,r){if(L.Util.readBit(t,1)){for(var i=L.Util.readBit(t,2)?16:8,e=new Array,o=this.OAM_START;o<this.OAM_END&&e.length<10;o+=4){var c=this.oamram(o),s=this.oamram(o+1),a=this.oamram(o+2),u=this.oamram(o+3);n<c-16||c-16<n-i||e.push({x:s,y:c,index:a,flags:u})}if(0!=e.length){for(var f={},h=new Array(R.physics.WIDTH),o=0;o<e.length;o++){var p=e[o],m=n-p.y+16,l=L.Util.readBit(u,4),d=L.Util.readBit(p.flags,5),y=L.Util.readBit(p.flags,6),S=f[p.index]||(f[p.index]=this.readTileData(p.index,32768,2*i));this.drawTileLine(S,m,d,y),this.copySpriteTileLine(h,this.tileBuffer,p.x-8,l)}this.copySpriteLineToBuffer(h,n)}}},p.prototype.copySpriteTileLine=function(t,n,r,i){for(var e=0;e<8;e++,r++)r<0||r>=R.physics.WIDTH||0==n[e]||(t[r]={color:n[e],palette:i})},p.prototype.copySpriteLineToBuffer=function(t,n){var r={};r[0]=p.getPalette(this.deviceram(this.OBP0)),r[1]=p.getPalette(this.deviceram(this.OBP1));for(var i,e,o=0;o<R.physics.WIDTH;o++)t[o]&&0!==(i=t[o].color)&&(e=t[o].palette,this.drawPixel(o,n,r[e][i]))},p.prototype.drawTile=function(t,n,r,i,e,o,c,s){o|=0,c|=0,s|=0;for(var a=0,u=0;u<8;u++)for(var f=c?7-u:u,h=t[a++],p=t[a++],m=0;m<8;m++){var l=1<<7-m,l=((h&l)>>7-m)+2*((p&l)>>7-m);s&&0==l||(i[n+(o?7-m:m)+(r+f)*e]=l)}},p.prototype.readTileData=function(t,n,r){r=r||16;for(var i=new Array,e=n+16*t,o=e;o<e+r;o++)i.push(this.vram(o));return i},p.prototype.drawWindow=function(t){if(L.Util.readBit(t,5)){var n,r=new Array(65536),i=L.Util.readBit(t,6)?p.tilemap.START_1:p.tilemap.START_0,e=!1;L.Util.readBit(t,4)?n=32768:(n=34816,e=!0);for(var o=0;o<p.tilemap.LENGTH;o++){var c=this.vram(o+i),c=(e&&(c=L.Util.getSignedValue(c)+128),this.readTileData(c,n)),s=o%p.tilemap.WIDTH,a=o/p.tilemap.WIDTH|0;this.drawTile(c,8*s,8*a,r,256)}for(var u=this.deviceram(this.WX)-7,f=this.deviceram(this.WY),s=Math.max(0,-u);s<Math.min(R.physics.WIDTH,R.physics.WIDTH-u);s++)for(a=Math.max(0,-f);a<Math.min(R.physics.HEIGHT,R.physics.HEIGHT-f);a++){var h=r[(255&s)+256*(255&a)];this.drawPixel(s+u,a+f,h)}}},p.prototype.drawPixel=function(t,n,r){this.buffer[160*n+t]=r},p.prototype.getPixel=function(t,n){return this.buffer[160*n+t]},p.getPalette=function(t){for(var n=[],r=0;r<8;r+=2)n.push((t&3<<r)>>r);return n},L.GPU=p}(GameboyJS=GameboyJS||{}),function(){"use strict";(GameboyJS||(GameboyJS={})).Screen=class i{constructor(t,n){this.physics={WIDTH:160,HEIGHT:144,FREQUENCY:60}}setPixelSize(t){}initImageData(){}clearScreen(){}fillImageData(t){for(var n=0;n<i.physics.HEIGHT;n++)for(var r=0;r<i.physics.WIDTH;r++);}render(t){}}}(),function(){"use strict";(GameboyJS||(GameboyJS={})).UnimplementedException=function t(n,r){this.message=n,this.name=t,this.fatal=r=void 0===r||r}}(),function(t){"use strict";function n(){this.extRam=null,this.ramSize=0,this.ramBank=0}n.prototype.loadRam=function(t,n){this.gameName=t,this.ramSize=n,this.ramBanksize=8192<=this.ramSize?8192:2048;t=this.getStorageKey(),t=localStorage.getItem(t);null==t?this.extRam=Array.apply(null,new Array(this.ramSize)).map(function(){return 0}):(this.extRam=JSON.parse(t),this.extRam.length!=n&&console.error("Found RAM data but not matching expected size."))},n.prototype.setRamBank=function(t){this.ramBank=t},n.prototype.manageWrite=function(t,n){this.extRam[8192*this.ramBank+t]=n},n.prototype.manageRead=function(t){return this.extRam[8192*this.ramBank+t]},n.prototype.getStorageKey=function(){return this.gameName+"_EXTRAM"},n.prototype.saveRamData=function(){localStorage.setItem(this.getStorageKey(),JSON.stringify(this.extRam))},t.ExtRam=n}(GameboyJS=GameboyJS||{}),function(t){"use strict";function n(t){this.gamepad=null,this.state={A:0,B:0,START:0,SELECT:0,LEFT:0,RIGHT:0,UP:0,DOWN:0},this.pullInterval=null,this.buttonMapping=t||r}var r={0:"UP",1:"DOWN",2:"LEFT",3:"RIGHT",4:"START",5:"SELECT",11:"A",12:"B"};n.prototype.init=function(t,n){this.onPress=t,this.onRelease=n;var r=this;window.addEventListener("gamepadconnected",function(t){r.gamepad=t.gamepad,r.activatePull()}),window.addEventListener("gamepaddisconnected",function(t){r.gamepad=null,r.deactivatePull()})},n.prototype.activatePull=function(){this.deactivatePull(),this.pullInterval=setInterval(this.pullState.bind(this),100)},n.prototype.deactivatePull=function(){clearInterval(this.pullInterval)},n.prototype.pullState=function(){for(var t in this.buttonMapping){var n=this.buttonMapping[t],r=this.state[n];this.state[n]=this.gamepad.buttons[t].pressed,1==this.state[n]&&0==r?this.managePress(n):0==this.state[n]&&1==r&&this.manageRelease(n)}},n.prototype.managePress=function(t){this.onPress(t)},n.prototype.manageRelease=function(t){this.onRelease(t)},t.Gamepad=n}(GameboyJS=GameboyJS||{}),function(n){"use strict";function r(t,n){this.cpu=t,this.memory=t.memory,this.P1=65280,this.state=0,n.init(this.pressKey.bind(this),this.releaseKey.bind(this))}r.keys={START:128,SELECT:64,B:32,A:16,DOWN:8,UP:4,LEFT:2,RIGHT:1},r.prototype.pressKey=function(t){this.state|=r.keys[t],this.cpu.requestInterrupt(n.CPU.INTERRUPTS.HILO)},r.prototype.releaseKey=function(t){t=255-r.keys[t];this.state&=t},r.prototype.update=function(){var t=this.memory.rb(this.P1);16&(t=48&~t)?t|=15&this.state:32&t?t|=(240&this.state)>>4:0==(48&t)&&(t&=240),this.memory[this.P1]=t=63&~t},n.Input=r}(GameboyJS=GameboyJS||{}),function(t){"use strict";function n(){}n.prototype.init=function(t,n){this.onPress=t,this.onRelease=n;var r=this;document.addEventListener("keydown",function(t){r.managePress(t.keyCode)}),document.addEventListener("keyup",function(t){r.manageRelease(t.keyCode)})},n.prototype.managePress=function(t){t=this.translateKey(t);t&&this.onPress(t)},n.prototype.manageRelease=function(t){t=this.translateKey(t);t&&this.onRelease(t)},n.prototype.translateKey=function(t){var n=null;switch(t){case 71:n="A";break;case 66:n="B";break;case 72:n="START";break;case 78:n="SELECT";break;case 37:n="LEFT";break;case 38:n="UP";break;case 39:n="RIGHT";break;case 40:n="DOWN"}return n},t.Keyboard=n}(GameboyJS=GameboyJS||{}),function(s){"use strict";var o={LDrrnn:function(t,n,r){t.wr(r,t.memory.rb(t.r.pc)),t.wr(n,t.memory.rb(t.r.pc+1)),t.r.pc+=2,t.clock.c+=12},LDrrar:function(t,n,r,i){o._LDav(t,s.Util.getRegAddr(t,n,r),t.r[i]),t.clock.c+=8},LDrrra:function(t,n,r,i){t.wr(n,t.memory.rb(s.Util.getRegAddr(t,r,i))),t.clock.c+=8},LDrn:function(t,n){t.wr(n,t.memory.rb(t.r.pc++)),t.clock.c+=8},LDrr:function(t,n,r){t.wr(n,t.r[r]),t.clock.c+=4},LDrar:function(t,n,r){t.memory.wb(t.r[n]+65280,t.r[r]),t.clock.c+=8},LDrra:function(t,n,r){t.wr(n,t.memory.rb(t.r[r]+65280)),t.clock.c+=8},LDspnn:function(t){t.wr("sp",(t.memory.rb(t.r.pc+1)<<8)+t.memory.rb(t.r.pc)),t.r.pc+=2,t.clock.c+=12},LDsprr:function(t,n,r){t.wr("sp",s.Util.getRegAddr(t,n,r)),t.clock.c+=8},LDnnar:function(t,n){var r=(t.memory.rb(t.r.pc+1)<<8)+t.memory.rb(t.r.pc);t.memory.wb(r,t.r[n]),t.r.pc+=2,t.clock.c+=16},LDrnna:function(t,n){var r=(t.memory.rb(t.r.pc+1)<<8)+t.memory.rb(t.r.pc);t.wr(n,t.memory.rb(r)),t.r.pc+=2,t.clock.c+=16},LDrrspn:function(t,n,r){var i=t.memory.rb(t.r.pc++),i=s.Util.getSignedValue(i),e=t.r.sp+i,o=255<(255&t.r.sp)+(255&i),c=(e&=65535,0);15<(15&t.r.sp)+(15&i)&&(c|=32),o&&(c|=16),t.wr("F",c),t.wr(n,e>>8),t.wr(r,255&e),t.clock.c+=12},LDnnsp:function(t){var n=t.memory.rb(t.r.pc++)+(t.memory.rb(t.r.pc++)<<8);o._LDav(t,n,255&t.r.sp),o._LDav(t,n+1,t.r.sp>>8),t.clock.c+=20},LDrran:function(t,n,r){n=s.Util.getRegAddr(t,n,r);o._LDav(t,n,t.memory.rb(t.r.pc++)),t.clock.c+=12},_LDav:function(t,n,r){t.memory.wb(n,r)},LDHnar:function(t,n){t.memory.wb(65280+t.memory.rb(t.r.pc++),t.r[n]),t.clock.c+=12},LDHrna:function(t,n){t.wr(n,t.memory.rb(65280+t.memory.rb(t.r.pc++))),t.clock.c+=12},INCrr:function(t,n,r){t.wr(r,t.r[r]+1&255),0==t.r[r]&&t.wr(n,t.r[n]+1&255),t.clock.c+=8},INCrra:function(t,n,r){var n=s.Util.getRegAddr(t,n,r),r=t.memory.rb(n)+1&255,i=0==r,e=15<1+(15&t.memory.rb(n));t.memory.wb(n,r),t.r.F&=16,e&&(t.r.F|=32),i&&(t.r.F|=128),t.clock.c+=12},INCsp:function(t){t.wr("sp",t.r.sp+1),t.r.sp&=65535,t.clock.c+=8},INCr:function(t,n){var r=1+(15&t.r[n])&16,n=(t.wr(n,t.r[n]+1&255),0==t.r[n]);t.r.F&=16,r&&(t.r.F|=32),n&&(t.r.F|=128),t.clock.c+=4},DECrr:function(t,n,r){t.wr(r,t.r[r]-1&255),255==t.r[r]&&t.wr(n,t.r[n]-1&255),t.clock.c+=8},DECsp:function(t){t.wr("sp",t.r.sp-1),t.r.sp&=65535,t.clock.c+=8},DECr:function(t,n){var r=(15&t.r[n])<1,n=(t.wr(n,t.r[n]-1&255),0==t.r[n]);t.r.F&=16,t.r.F|=64,r&&(t.r.F|=32),n&&(t.r.F|=128),t.clock.c+=4},DECrra:function(t,n,r){var n=s.Util.getRegAddr(t,n,r),r=t.memory.rb(n)-1&255,i=0==r,e=(15&t.memory.rb(n))<1;t.memory.wb(n,r),t.r.F&=16,t.r.F|=64,e&&(t.r.F|=32),i&&(t.r.F|=128),t.clock.c+=12},ADDrr:function(t,n,r){r=t.r[r];o._ADDrn(t,n,r),t.clock.c+=4},ADDrn:function(t,n){var r=t.memory.rb(t.r.pc++);o._ADDrn(t,n,r),t.clock.c+=8},_ADDrn:function(t,n,r){var i=(15&t.r[n])+(15&r)&16,r=(t.wr(n,t.r[n]+r),256&t.r[n]),e=(t.r[n]&=255,0);0==t.r[n]&&(e|=128),i&&(e|=32),r&&(e|=16),t.wr("F",e)},ADDrrrr:function(t,n,r,i,e){o._ADDrrn(t,n,r,(t.r[i]<<8)+t.r[e]),t.clock.c+=8},ADDrrsp:function(t,n,r){o._ADDrrn(t,n,r,t.r.sp),t.clock.c+=8},ADDspn:function(t){var n=t.memory.rb(t.r.pc++),n=s.Util.getSignedValue(n),r=255<(255&t.r.sp)+(255&n),i=0;15<(15&t.r.sp)+(15&n)&&(i|=32),r&&(i|=16),t.wr("F",i),t.wr("sp",t.r.sp+n&65535),t.clock.c+=16},_ADDrrn:function(t,n,r,i){var e=(t.r[n]<<8)+t.r[r],o=e+i,c=65536&o,e=(4095&e)+(4095&i)&4096,i=128&t.r.F,r=(t.r[r]=255&(o&=65535),t.r[n]=255&(o>>=8),0);i&&(r|=128),e&&(r|=32),c&&(r|=16),t.r.F=r},ADCrr:function(t,n,r){r=t.r[r];o._ADCrn(t,n,r),t.clock.c+=4},ADCrn:function(t,n){var r=t.memory.rb(t.r.pc++);o._ADCrn(t,n,r),t.clock.c+=8},_ADCrn:function(t,n,r){var i=16&t.r.F?1:0,e=(15&t.r[n])+(15&r)+i&16,r=(t.wr(n,t.r[n]+r+i),i=256&t.r[n],t.r[n]&=255,0);0==t.r[n]&&(r|=128),e&&(r|=32),i&&(r|=16),t.r.F=r},ADCrrra:function(t,n,r,i){r=t.memory.rb(s.Util.getRegAddr(t,r,i));o._ADCrn(t,n,r),t.clock.c+=8},ADDrrra:function(t,n,r,i){var r=t.memory.rb(s.Util.getRegAddr(t,r,i)),i=(15&t.r[n])+(15&r)&16,r=(t.wr(n,t.r[n]+r),256&t.r[n]),e=(t.r[n]&=255,0);0==t.r[n]&&(e|=128),i&&(e|=32),r&&(e|=16),t.wr("F",e),t.clock.c+=8},SUBr:function(t,n){n=t.r[n];o._SUBn(t,n),t.clock.c+=4},SUBn:function(t){var n=t.memory.rb(t.r.pc++);o._SUBn(t,n),t.clock.c+=8},SUBrra:function(t,n,r){n=t.memory.rb(s.Util.getRegAddr(t,n,r));o._SUBn(t,n),t.clock.c+=8},_SUBn:function(t,n){var r=t.r.A<n,i=(15&t.r.A)<(15&n);t.wr("A",t.r.A-n),t.r.A&=255;n=64;0==t.r.A&&(n|=128),i&&(n|=32),r&&(n|=16),t.wr("F",n)},SBCn:function(t){var n=t.memory.rb(t.r.pc++);o._SBCn(t,n),t.clock.c+=8},SBCr:function(t,n){n=t.r[n];o._SBCn(t,n),t.clock.c+=4},SBCrra:function(t,n,r){n=t.memory.rb((t.r[n]<<8)+t.r[r]);o._SBCn(t,n),t.clock.c+=8},_SBCn:function(t,n){var r=16&t.r.F?1:0,i=t.r.A<n+r,e=(15&t.r.A)<(15&n)+r;t.wr("A",t.r.A-n-r),t.r.A&=255;n=64;0==t.r.A&&(n|=128),e&&(n|=32),i&&(n|=16),t.r.F=n},ORr:function(t,n){t.r.A|=t.r[n],t.r.F=0==t.r.A?128:0,t.clock.c+=4},ORn:function(t){t.r.A|=t.memory.rb(t.r.pc++),t.r.F=0==t.r.A?128:0,t.clock.c+=8},ORrra:function(t,n,r){t.r.A|=t.memory.rb((t.r[n]<<8)+t.r[r]),t.r.F=0==t.r.A?128:0,t.clock.c+=8},ANDr:function(t,n){t.r.A&=t.r[n],t.r.F=0==t.r.A?160:32,t.clock.c+=4},ANDn:function(t){t.r.A&=t.memory.rb(t.r.pc++),t.r.F=0==t.r.A?160:32,t.clock.c+=8},ANDrra:function(t,n,r){t.r.A&=t.memory.rb(s.Util.getRegAddr(t,n,r)),t.r.F=0==t.r.A?160:32,t.clock.c+=8},XORr:function(t,n){t.r.A^=t.r[n],t.r.F=0==t.r.A?128:0,t.clock.c+=4},XORn:function(t){t.r.A^=t.memory.rb(t.r.pc++),t.r.F=0==t.r.A?128:0,t.clock.c+=8},XORrra:function(t,n,r){t.r.A^=t.memory.rb((t.r[n]<<8)+t.r[r]),t.r.F=0==t.r.A?128:0,t.clock.c+=8},CPr:function(t,n){n=t.r[n];o._CPn(t,n),t.clock.c+=4},CPn:function(t){var n=t.memory.rb(t.r.pc++);o._CPn(t,n),t.clock.c+=8},CPrra:function(t,n,r){n=t.memory.rb(s.Util.getRegAddr(t,n,r));o._CPn(t,n),t.clock.c+=8},_CPn:function(t,n){var r=t.r.A<n,i=64;t.r.A==n&&(i+=128),(15&t.r.A)<(15&n)&&(i+=32),r&&(i+=16),t.r.F=i},RRCr:function(t,n){t.r.F=0;var r=1&t.r[n];r&&(t.r.F|=16),t.r[n]=t.r[n]>>1|128*r,0==t.r[n]&&(t.r.F|=128),t.clock.c+=4},RRCrra:function(t,n,r){n=s.Util.getRegAddr(t,n,r),t.r.F=0,r=1&t.memory.rb(n);r&&(t.r.F|=16),t.memory.wb(n,t.memory.rb(n)>>1|128*r),0==t.memory.rb(n)&&(t.r.F|=128),t.clock.c+=12},RLCr:function(t,n){t.r.F=0;var r=128&t.r[n]?1:0;r&&(t.r.F|=16),t.r[n]=(t.r[n]<<1)+r&255,0==t.r[n]&&(t.r.F|=128),t.clock.c+=4},RLCrra:function(t,n,r){n=s.Util.getRegAddr(t,n,r),t.r.F=0,r=128&t.memory.rb(n)?1:0;r&&(t.r.F|=16),t.memory.wb(n,(t.memory.rb(n)<<1)+r&255),0==t.memory.rb(n)&&(t.r.F|=128),t.clock.c+=12},RLr:function(t,n){var r=16&t.r.F?1:0;t.r.F=0,128&t.r[n]?t.r.F|=16:t.r.F&=239,t.r[n]=(t.r[n]<<1)+r&255,0==t.r[n]&&(t.r.F|=128),t.clock.c+=4},RLrra:function(t,n,r){n=s.Util.getRegAddr(t,n,r),r=16&t.r.F?1:0;t.r.F=0,128&t.memory.rb(n)?t.r.F|=16:t.r.F&=239,t.memory.wb(n,(t.memory.rb(n)<<1)+r&255),0==t.memory.rb(n)&&(t.r.F|=128),t.clock.c+=12},RRr:function(t,n){var r=16&t.r.F?1:0;t.r.F=0,1&t.r[n]?t.r.F|=16:t.r.F&=239,t.r[n]=t.r[n]>>1|128*r,0==t.r[n]&&(t.r.F|=128),t.clock.c+=4},RRrra:function(t,n,r){n=s.Util.getRegAddr(t,n,r),r=16&t.r.F?1:0;t.r.F=0,1&t.memory.rb(n)?t.r.F|=16:t.r.F&=239,t.memory.wb(n,t.memory.rb(n)>>1|128*r),0==t.memory.rb(n)&&(t.r.F|=128),t.clock.c+=12},SRAr:function(t,n){t.r.F=0,1&t.r[n]&&(t.r.F|=16);var r=128&t.r[n];t.r[n]=t.r[n]>>1|r,0==t.r[n]&&(t.r.F|=128),t.clock.c+=4},SRArra:function(t,n,r){n=s.Util.getRegAddr(t,n,r),t.r.F=0,1&t.memory.rb(n)&&(t.r.F|=16),r=128&t.memory.rb(n);t.memory.wb(n,t.memory.rb(n)>>1|r),0==t.memory.rb(n)&&(t.r.F|=128),t.clock.c+=12},SLAr:function(t,n){t.r.F=0,128&t.r[n]&&(t.r.F|=16),t.r[n]=t.r[n]<<1&255,0==t.r[n]&&(t.r.F|=128),t.clock.c+=4},SLArra:function(t,n,r){n=s.Util.getRegAddr(t,n,r);t.r.F=0,128&t.memory.rb(n)&&(t.r.F|=16),t.memory.wb(n,t.memory.rb(n)<<1&255),0==t.memory.rb(n)&&(t.r.F|=128),t.clock.c+=12},SRLr:function(t,n){t.r.F=0,1&t.r[n]&&(t.r.F|=16),t.r[n]=t.r[n]>>1,0==t.r[n]&&(t.r.F|=128),t.clock.c+=4},SRLrra:function(t,n,r){n=s.Util.getRegAddr(t,n,r);t.r.F=0,1&t.memory.rb(n)&&(t.r.F|=16),t.memory.wb(n,t.memory.rb(n)>>1),0==t.memory.rb(n)&&(t.r.F|=128),t.clock.c+=12},BITir:function(t,n,r){r=t.r[r]&1<<n?0:1,n=16&t.r.F;n|=32,r&&(n|=128),t.r.F=n,t.clock.c+=4},BITirra:function(t,n,r,i){r=s.Util.getRegAddr(t,r,i),i=1<<n,n=t.memory.rb(r)&i?0:1,r=16&t.r.F;r|=32,n&&(r|=128),t.r.F=r,t.clock.c+=8},SETir:function(t,n,r){t.r[r]|=1<<n,t.clock.c+=4},SETirra:function(t,n,r,i){r=s.Util.getRegAddr(t,r,i),i=1<<n;t.memory.wb(r,t.memory.rb(r)|i),t.clock.c+=12},RESir:function(t,n,r){t.r[r]&=255-(1<<n),t.clock.c+=4},RESirra:function(t,n,r,i){r=s.Util.getRegAddr(t,r,i),i=255-(1<<n);t.memory.wb(r,t.memory.rb(r)&i),t.clock.c+=12},SWAPr:function(t,n){t.r[n]=o._SWAPn(t,t.r[n]),t.clock.c+=4},SWAPrra:function(t,n,r){n=(t.r[n]<<8)+t.r[r];t.memory.wb(n,o._SWAPn(t,t.memory.rb(n))),t.clock.c+=12},_SWAPn:function(t,n){return t.r.F=0==n?128:0,(240&n)>>4|(15&n)<<4},JPnn:function(t){t.wr("pc",(t.memory.rb(t.r.pc+1)<<8)+t.memory.rb(t.r.pc)),t.clock.c+=16},JRccn:function(t,n){s.Util.testFlag(t,n)?(n=t.memory.rb(t.r.pc++),n=s.Util.getSignedValue(n),t.r.pc+=n,t.clock.c+=4):t.r.pc++,t.clock.c+=8},JPccnn:function(t,n){s.Util.testFlag(t,n)?(t.wr("pc",(t.memory.rb(t.r.pc+1)<<8)+t.memory.rb(t.r.pc)),t.clock.c+=4):t.r.pc+=2,t.clock.c+=12},JPrr:function(t,n,r){t.r.pc=(t.r[n]<<8)+t.r[r],t.clock.c+=4},JRn:function(t){var n=t.memory.rb(t.r.pc++),n=s.Util.getSignedValue(n);t.r.pc+=n,t.clock.c+=12},PUSHrr:function(t,n,r){t.wr("sp",t.r.sp-1),t.memory.wb(t.r.sp,t.r[n]),t.wr("sp",t.r.sp-1),t.memory.wb(t.r.sp,t.r[r]),t.clock.c+=16},POPrr:function(t,n,r){t.wr(r,t.memory.rb(t.r.sp)),t.wr("sp",t.r.sp+1),t.wr(n,t.memory.rb(t.r.sp)),t.wr("sp",t.r.sp+1),t.clock.c+=12},RSTn:function(t,n){t.wr("sp",t.r.sp-1),t.memory.wb(t.r.sp,t.r.pc>>8),t.wr("sp",t.r.sp-1),t.memory.wb(t.r.sp,255&t.r.pc),t.r.pc=n,t.clock.c+=16},RET:function(t){t.r.pc=t.memory.rb(t.r.sp),t.wr("sp",t.r.sp+1),t.r.pc+=t.memory.rb(t.r.sp)<<8,t.wr("sp",t.r.sp+1),t.clock.c+=16},RETcc:function(t,n){s.Util.testFlag(t,n)&&(t.r.pc=t.memory.rb(t.r.sp),t.wr("sp",t.r.sp+1),t.r.pc+=t.memory.rb(t.r.sp)<<8,t.wr("sp",t.r.sp+1),t.clock.c+=12),t.clock.c+=8},CALLnn:function(t){o._CALLnn(t),t.clock.c+=24},CALLccnn:function(t,n){s.Util.testFlag(t,n)?(o._CALLnn(t),t.clock.c+=12):t.r.pc+=2,t.clock.c+=12},_CALLnn:function(t){t.wr("sp",t.r.sp-1),t.memory.wb(t.r.sp,(t.r.pc+2&65280)>>8),t.wr("sp",t.r.sp-1),t.memory.wb(t.r.sp,t.r.pc+2&255);var n=t.memory.rb(t.r.pc)+(t.memory.rb(t.r.pc+1)<<8);t.r.pc=n},CPL:function(t){t.wr("A",255&~t.r.A),t.r.F|=96,t.clock.c+=4},CCF:function(t){t.r.F&=159,16&t.r.F?t.r.F&=224:t.r.F|=16,t.clock.c+=4},SCF:function(t){t.r.F&=159,t.r.F|=16,t.clock.c+=4},DAA:function(t){var n=64&t.r.F?1:0,r=32&t.r.F?1:0,i=16&t.r.F?1:0;n?(r&&(t.r.A=t.r.A-6&255),i&&(t.r.A-=96)):((9<(15&t.r.A)||r)&&(t.r.A+=6),(159<t.r.A||i)&&(t.r.A+=96)),256&t.r.A&&(i=1),t.r.A&=255,t.r.F&=64,0==t.r.A&&(t.r.F|=128),i&&(t.r.F|=16),t.clock.c+=4},HALT:function(t){t.halt(),t.clock.c+=4},DI:function(t){t.disableInterrupts(),t.clock.c+=4},EI:function(t){t.enableInterrupts(),t.clock.c+=4},RETI:function(t){t.enableInterrupts(),o.RET(t)},CB:function(t){var n=t.memory.rb(t.r.pc++);s.opcodeCbmap[n](t),t.clock.c+=4}};s.cpuOps=o}(GameboyJS=GameboyJS||{}),function(e){"use strict";function t(t,n){this.options=e.Util.extend({},o,n=n||{});var n=new e.CPU(this),t=new e.Screen(t,this.options.zoom),r=new e.GPU(t,n),r=(n.gpu=r,new this.options.pad.class(this.options.pad.mapping)),i=new e.Input(n,r);n.input=i,this.cpu=n,this.screen=t,this.input=i,this.pad=r,this.createRom(this.options.romReaders),this.statusContainer=document.getElementById(this.options.statusContainerId)||document.createElement("div"),this.gameNameContainer=document.getElementById(this.options.gameNameContainerId)||document.createElement("div"),this.errorContainer=document.getElementById(this.options.errorContainerId)||document.createElement("div")}var o={pad:{class:e.Keyboard,mapping:null},zoom:1,romReaders:[],statusContainerId:"status",gameNameContainerId:"game-name",errorContainerId:"error"};t.prototype.createRom=function(t){var n=new e.Rom(this);if(0==t.length){var r=new e.RomFileReader;n.addReader(r)}else for(var i in t)t.hasOwnProperty(i)&&n.addReader(t[i])},t.prototype.startRom=function(t){this.errorContainer.classList.add("hide"),this.cpu.reset();try{this.cpu.loadRom(t.data),this.setStatus("Game Running :"),this.setGameName(this.cpu.getGameName()),this.cpu.run()}catch(t){this.handleException(t)}},t.prototype.pause=function(t){t?(this.setStatus("Game Paused :"),this.cpu.pause()):(this.setStatus("Game Running :"),this.cpu.unpause())},t.prototype.error=function(t){this.setStatus("Error during execution"),this.setError("An error occurred during execution:"+t),this.cpu.stop()},t.prototype.setStatus=function(t){this.statusContainer.innerHTML=t},t.prototype.setError=function(t){this.errorContainer.classList.remove("hide"),this.errorContainer.innerHTML=t},t.prototype.setGameName=function(t){this.gameNameContainer.innerHTML=t},t.prototype.setSoundEnabled=function(t){t?this.cpu.apu.connect():this.cpu.apu.disconnect()},t.prototype.setScreenZoom=function(t){this.screen.setPixelSize(t)},t.prototype.handleException=function(t){if(!(t instanceof e.UnimplementedException))throw t;t.fatal?this.error("This cartridge is not supported ("+t.message+")"):console.error(t.message)},e.Gameboy=t}(GameboyJS=GameboyJS||{}),function(i){"use strict";var t={getMbcInstance:function(t,n){var r;switch(n){case 0:r=new s(t);break;case 1:case 2:case 3:r=new e(t);break;case 15:case 16:case 17:case 18:case 19:r=new o(t);break;case 25:case 26:case 27:case 28:case 29:case 30:r=new c(t);break;default:throw new i.UnimplementedException("MBC type not supported")}return r}},e=function(t){this.memory=t,this.romBankNumber=1,this.mode=0,this.ramEnabled=!0,this.extRam=new i.ExtRam},o=(e.prototype.loadRam=function(t,n){this.extRam.loadRam(t,n)},e.prototype.manageWrite=function(t,n){switch(61440&t){case 0:case 4096:this.ramEnabled=!!(10&n),this.ramEnabled&&this.extRam.saveRamData();break;case 8192:case 12288:var r=this.mode?0:224;this.romBankNumber=(this.romBankNumber&r)+(n=0==(n&=31)?1:n),this.memory.loadRomBank(this.romBankNumber);break;case 16384:case 20480:n&=3,0==this.mode?(this.romBankNumber=31&this.romBankNumber|n<<5,this.memory.loadRomBank(this.romBankNumber)):this.extRam.setRamBank(n);break;case 24576:case 28672:this.mode=1&n;break;case 40960:case 45056:this.extRam.manageWrite(t-40960,n)}},e.prototype.readRam=function(t){return this.extRam.manageRead(t-40960)},function(t){this.memory=t,this.romBankNumber=1,this.ramEnabled=!0,this.extRam=new i.ExtRam}),c=(o.prototype.loadRam=function(t,n){this.extRam.loadRam(t,n)},o.prototype.manageWrite=function(t,n){switch(61440&t){case 0:case 4096:this.ramEnabled=!!(10&n),this.ramEnabled&&this.extRam.saveRamData();break;case 8192:case 12288:this.romBankNumber=n=0==(n&=127)?1:n,this.memory.loadRomBank(this.romBankNumber);break;case 16384:case 20480:this.extRam.setRamBank(n);break;case 24576:case 28672:throw new i.UnimplementedException("cartridge clock not supported",!1);case 40960:case 45056:this.extRam.manageWrite(t-40960,n)}},o.prototype.readRam=function(t){return this.extRam.manageRead(t-40960)},o),s=function(t){this.memory=t};s.prototype.manageWrite=function(t,n){this.memory.loadRomBank(n)},s.prototype.readRam=function(t){return 0},s.prototype.loadRam=function(){},i.MBC=t}(GameboyJS=GameboyJS||{}),function(n){"use strict";function i(t){this.MEM_SIZE=65536,this.MBCtype=0,this.banksize=16384,this.rom=null,this.mbc=null,this.cpu=t}i.addresses={VRAM_START:32768,VRAM_END:40959,EXTRAM_START:40960,EXTRAM_END:49151,OAM_START:65024,OAM_END:65183,DEVICE_START:65280,DEVICE_END:65407},(i.prototype=new Array).reset=function(){this.length=this.MEM_SIZE;for(var t=i.addresses.VRAM_START;t<=i.addresses.VRAM_END;t++)this[t]=0;for(t=i.addresses.DEVICE_START;t<=i.addresses.DEVICE_END;t++)this[t]=0;this[65535]=0},i.prototype.setRomData=function(t){this.rom=t,this.loadRomBank(0),this.mbc=n.MBC.getMbcInstance(this,this[327]),this.loadRomBank(1),this.mbc.loadRam(this.cpu.getGameName(),this.cpu.getRamSize())},i.prototype.loadRomBank=function(t){for(var n=t?16384:0,r=16384*t,i=0;i<this.banksize;i++)this[i+n]=this.rom[r+i]},i.prototype.vram=function(t){if(t<i.addresses.VRAM_START||t>i.addresses.VRAM_END)throw"VRAM access in out of bounds address "+t;return this[t]},i.prototype.oamram=function(t){if(t<i.addresses.OAM_START||t>i.addresses.OAM_END)throw"OAMRAM access in out of bounds address "+t;return this[t]},i.prototype.deviceram=function(t,n){if(t<i.addresses.DEVICERAM_START||t>i.addresses.DEVICERAM_END)throw"Device RAM access in out of bounds address "+t;if(void 0===n)return this[t];this[t]=n},i.prototype.rb=function(t){var n;return 65296<=t&&t<65344?(n=r[t-65296],this[t]|n):40960<=t&&t<49152?this.mbc.readRam(t):this[t]};var r=[128,63,0,255,191,255,63,0,255,191,127,255,159,255,191,255,255,0,0,191,0,0,112,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];i.prototype.wb=function(t,n){t<32768||40960<=t&&t<49152?this.mbc.manageWrite(t,n):65296<=t&&t<=65343?this.cpu.apu.manageWrite(t,n):65280==t?this[t]=15&this[t]|48&n:(this[t]=n,65280==(65280&t)&&(65282==t&&128&n&&this.cpu.enableSerialTransfer(),65284==t&&this.cpu.resetDivTimer(),65350==t)&&this.dmaTransfer(n))},i.prototype.dmaTransfer=function(t){for(var n=t<<8,r=0;r<160;r++)this[i.addresses.OAM_START+r]=this[n+r]},n.Memory=i}(GameboyJS=GameboyJS||{}),function(t){"use strict";var n=t.cpuOps,r={0:function(t){n.RLCr(t,"B")},1:function(t){n.RLCr(t,"C")},2:function(t){n.RLCr(t,"D")},3:function(t){n.RLCr(t,"E")},4:function(t){n.RLCr(t,"H")},5:function(t){n.RLCr(t,"L")},6:function(t){n.RLCrra(t,"H","L")},7:function(t){n.RLCr(t,"A")},8:function(t){n.RRCr(t,"B")},9:function(t){n.RRCr(t,"C")},10:function(t){n.RRCr(t,"D")},11:function(t){n.RRCr(t,"E")},12:function(t){n.RRCr(t,"H")},13:function(t){n.RRCr(t,"L")},14:function(t){n.RRCrra(t,"H","L")},15:function(t){n.RRCr(t,"A")},16:function(t){n.RLr(t,"B")},17:function(t){n.RLr(t,"C")},18:function(t){n.RLr(t,"D")},19:function(t){n.RLr(t,"E")},20:function(t){n.RLr(t,"H")},21:function(t){n.RLr(t,"L")},22:function(t){n.RLrra(t,"H","L")},23:function(t){n.RLr(t,"A")},24:function(t){n.RRr(t,"B")},25:function(t){n.RRr(t,"C")},26:function(t){n.RRr(t,"D")},27:function(t){n.RRr(t,"E")},28:function(t){n.RRr(t,"H")},29:function(t){n.RRr(t,"L")},30:function(t){n.RRrra(t,"H","L")},31:function(t){n.RRr(t,"A")},32:function(t){n.SLAr(t,"B")},33:function(t){n.SLAr(t,"C")},34:function(t){n.SLAr(t,"D")},35:function(t){n.SLAr(t,"E")},36:function(t){n.SLAr(t,"H")},37:function(t){n.SLAr(t,"L")},38:function(t){n.SLArra(t,"H","L")},39:function(t){n.SLAr(t,"A")},40:function(t){n.SRAr(t,"B")},41:function(t){n.SRAr(t,"C")},42:function(t){n.SRAr(t,"D")},43:function(t){n.SRAr(t,"E")},44:function(t){n.SRAr(t,"H")},45:function(t){n.SRAr(t,"L")},46:function(t){n.SRArra(t,"H","L")},47:function(t){n.SRAr(t,"A")},48:function(t){n.SWAPr(t,"B")},49:function(t){n.SWAPr(t,"C")},50:function(t){n.SWAPr(t,"D")},51:function(t){n.SWAPr(t,"E")},52:function(t){n.SWAPr(t,"H")},53:function(t){n.SWAPr(t,"L")},54:function(t){n.SWAPrra(t,"H","L")},55:function(t){n.SWAPr(t,"A")},56:function(t){n.SRLr(t,"B")},57:function(t){n.SRLr(t,"C")},58:function(t){n.SRLr(t,"D")},59:function(t){n.SRLr(t,"E")},60:function(t){n.SRLr(t,"H")},61:function(t){n.SRLr(t,"L")},62:function(t){n.SRLrra(t,"H","L")},63:function(t){n.SRLr(t,"A")},64:function(t){n.BITir(t,0,"B")},65:function(t){n.BITir(t,0,"C")},66:function(t){n.BITir(t,0,"D")},67:function(t){n.BITir(t,0,"E")},68:function(t){n.BITir(t,0,"H")},69:function(t){n.BITir(t,0,"L")},70:function(t){n.BITirra(t,0,"H","L")},71:function(t){n.BITir(t,0,"A")},72:function(t){n.BITir(t,1,"B")},73:function(t){n.BITir(t,1,"C")},74:function(t){n.BITir(t,1,"D")},75:function(t){n.BITir(t,1,"E")},76:function(t){n.BITir(t,1,"H")},77:function(t){n.BITir(t,1,"L")},78:function(t){n.BITirra(t,1,"H","L")},79:function(t){n.BITir(t,1,"A")},80:function(t){n.BITir(t,2,"B")},81:function(t){n.BITir(t,2,"C")},82:function(t){n.BITir(t,2,"D")},83:function(t){n.BITir(t,2,"E")},84:function(t){n.BITir(t,2,"H")},85:function(t){n.BITir(t,2,"L")},86:function(t){n.BITirra(t,2,"H","L")},87:function(t){n.BITir(t,2,"A")},88:function(t){n.BITir(t,3,"B")},89:function(t){n.BITir(t,3,"C")},90:function(t){n.BITir(t,3,"D")},91:function(t){n.BITir(t,3,"E")},92:function(t){n.BITir(t,3,"H")},93:function(t){n.BITir(t,3,"L")},94:function(t){n.BITirra(t,3,"H","L")},95:function(t){n.BITir(t,3,"A")},96:function(t){n.BITir(t,4,"B")},97:function(t){n.BITir(t,4,"C")},98:function(t){n.BITir(t,4,"D")},99:function(t){n.BITir(t,4,"E")},100:function(t){n.BITir(t,4,"H")},101:function(t){n.BITir(t,4,"L")},102:function(t){n.BITirra(t,4,"H","L")},103:function(t){n.BITir(t,4,"A")},104:function(t){n.BITir(t,5,"B")},105:function(t){n.BITir(t,5,"C")},106:function(t){n.BITir(t,5,"D")},107:function(t){n.BITir(t,5,"E")},108:function(t){n.BITir(t,5,"H")},109:function(t){n.BITir(t,5,"L")},110:function(t){n.BITirra(t,5,"H","L")},111:function(t){n.BITir(t,5,"A")},112:function(t){n.BITir(t,6,"B")},113:function(t){n.BITir(t,6,"C")},114:function(t){n.BITir(t,6,"D")},115:function(t){n.BITir(t,6,"E")},116:function(t){n.BITir(t,6,"H")},117:function(t){n.BITir(t,6,"L")},118:function(t){n.BITirra(t,6,"H","L")},119:function(t){n.BITir(t,6,"A")},120:function(t){n.BITir(t,7,"B")},121:function(t){n.BITir(t,7,"C")},122:function(t){n.BITir(t,7,"D")},123:function(t){n.BITir(t,7,"E")},124:function(t){n.BITir(t,7,"H")},125:function(t){n.BITir(t,7,"L")},126:function(t){n.BITirra(t,7,"H","L")},127:function(t){n.BITir(t,7,"A")},128:function(t){n.RESir(t,0,"B")},129:function(t){n.RESir(t,0,"C")},130:function(t){n.RESir(t,0,"D")},131:function(t){n.RESir(t,0,"E")},132:function(t){n.RESir(t,0,"H")},133:function(t){n.RESir(t,0,"L")},134:function(t){n.RESirra(t,0,"H","L")},135:function(t){n.RESir(t,0,"A")},136:function(t){n.RESir(t,1,"B")},137:function(t){n.RESir(t,1,"C")},138:function(t){n.RESir(t,1,"D")},139:function(t){n.RESir(t,1,"E")},140:function(t){n.RESir(t,1,"H")},141:function(t){n.RESir(t,1,"L")},142:function(t){n.RESirra(t,1,"H","L")},143:function(t){n.RESir(t,1,"A")},144:function(t){n.RESir(t,2,"B")},145:function(t){n.RESir(t,2,"C")},146:function(t){n.RESir(t,2,"D")},147:function(t){n.RESir(t,2,"E")},148:function(t){n.RESir(t,2,"H")},149:function(t){n.RESir(t,2,"L")},150:function(t){n.RESirra(t,2,"H","L")},151:function(t){n.RESir(t,2,"A")},152:function(t){n.RESir(t,3,"B")},153:function(t){n.RESir(t,3,"C")},154:function(t){n.RESir(t,3,"D")},155:function(t){n.RESir(t,3,"E")},156:function(t){n.RESir(t,3,"H")},157:function(t){n.RESir(t,3,"L")},158:function(t){n.RESirra(t,3,"H","L")},159:function(t){n.RESir(t,3,"A")},160:function(t){n.RESir(t,4,"B")},161:function(t){n.RESir(t,4,"C")},162:function(t){n.RESir(t,4,"D")},163:function(t){n.RESir(t,4,"E")},164:function(t){n.RESir(t,4,"H")},165:function(t){n.RESir(t,4,"L")},166:function(t){n.RESirra(t,4,"H","L")},167:function(t){n.RESir(t,4,"A")},168:function(t){n.RESir(t,5,"B")},169:function(t){n.RESir(t,5,"C")},170:function(t){n.RESir(t,5,"D")},171:function(t){n.RESir(t,5,"E")},172:function(t){n.RESir(t,5,"H")},173:function(t){n.RESir(t,5,"L")},174:function(t){n.RESirra(t,5,"H","L")},175:function(t){n.RESir(t,5,"A")},176:function(t){n.RESir(t,6,"B")},177:function(t){n.RESir(t,6,"C")},178:function(t){n.RESir(t,6,"D")},179:function(t){n.RESir(t,6,"E")},180:function(t){n.RESir(t,6,"H")},181:function(t){n.RESir(t,6,"L")},182:function(t){n.RESirra(t,6,"H","L")},183:function(t){n.RESir(t,6,"A")},184:function(t){n.RESir(t,7,"B")},185:function(t){n.RESir(t,7,"C")},186:function(t){n.RESir(t,7,"D")},187:function(t){n.RESir(t,7,"E")},188:function(t){n.RESir(t,7,"H")},189:function(t){n.RESir(t,7,"L")},190:function(t){n.RESirra(t,7,"H","L")},191:function(t){n.RESir(t,7,"A")},192:function(t){n.SETir(t,0,"B")},193:function(t){n.SETir(t,0,"C")},194:function(t){n.SETir(t,0,"D")},195:function(t){n.SETir(t,0,"E")},196:function(t){n.SETir(t,0,"H")},197:function(t){n.SETir(t,0,"L")},198:function(t){n.SETirra(t,0,"H","L")},199:function(t){n.SETir(t,0,"A")},200:function(t){n.SETir(t,1,"B")},201:function(t){n.SETir(t,1,"C")},202:function(t){n.SETir(t,1,"D")},203:function(t){n.SETir(t,1,"E")},204:function(t){n.SETir(t,1,"H")},205:function(t){n.SETir(t,1,"L")},206:function(t){n.SETirra(t,1,"H","L")},207:function(t){n.SETir(t,1,"A")},208:function(t){n.SETir(t,2,"B")},209:function(t){n.SETir(t,2,"C")},210:function(t){n.SETir(t,2,"D")},211:function(t){n.SETir(t,2,"E")},212:function(t){n.SETir(t,2,"H")},213:function(t){n.SETir(t,2,"L")},214:function(t){n.SETirra(t,2,"H","L")},215:function(t){n.SETir(t,2,"A")},216:function(t){n.SETir(t,3,"B")},217:function(t){n.SETir(t,3,"C")},218:function(t){n.SETir(t,3,"D")},219:function(t){n.SETir(t,3,"E")},220:function(t){n.SETir(t,3,"H")},221:function(t){n.SETir(t,3,"L")},222:function(t){n.SETirra(t,3,"H","L")},223:function(t){n.SETir(t,3,"A")},224:function(t){n.SETir(t,4,"B")},225:function(t){n.SETir(t,4,"C")},226:function(t){n.SETir(t,4,"D")},227:function(t){n.SETir(t,4,"E")},228:function(t){n.SETir(t,4,"H")},229:function(t){n.SETir(t,4,"L")},230:function(t){n.SETirra(t,4,"H","L")},231:function(t){n.SETir(t,4,"A")},232:function(t){n.SETir(t,5,"B")},233:function(t){n.SETir(t,5,"C")},234:function(t){n.SETir(t,5,"D")},235:function(t){n.SETir(t,5,"E")},236:function(t){n.SETir(t,5,"H")},237:function(t){n.SETir(t,5,"L")},238:function(t){n.SETirra(t,5,"H","L")},239:function(t){n.SETir(t,5,"A")},240:function(t){n.SETir(t,6,"B")},241:function(t){n.SETir(t,6,"C")},242:function(t){n.SETir(t,6,"D")},243:function(t){n.SETir(t,6,"E")},244:function(t){n.SETir(t,6,"H")},245:function(t){n.SETir(t,6,"L")},246:function(t){n.SETirra(t,6,"H","L")},247:function(t){n.SETir(t,6,"A")},248:function(t){n.SETir(t,7,"B")},249:function(t){n.SETir(t,7,"C")},250:function(t){n.SETir(t,7,"D")},251:function(t){n.SETir(t,7,"E")},252:function(t){n.SETir(t,7,"H")},253:function(t){n.SETir(t,7,"L")},254:function(t){n.SETirra(t,7,"H","L")},255:function(t){n.SETir(t,7,"A")}};t.opcodeMap={0:function(t){t.clock.c+=4},1:function(t){n.LDrrnn(t,"B","C")},2:function(t){n.LDrrar(t,"B","C","A")},3:function(t){n.INCrr(t,"B","C")},4:function(t){n.INCr(t,"B")},5:function(t){n.DECr(t,"B")},6:function(t){n.LDrn(t,"B")},7:function(t){var n=128&t.r.A?1:0;t.r.F=n?16:0,t.wr("A",(t.r.A<<1)+n&255),t.clock.c+=4},8:function(t){n.LDnnsp(t)},9:function(t){n.ADDrrrr(t,"H","L","B","C")},10:function(t){n.LDrrra(t,"A","B","C")},11:function(t){n.DECrr(t,"B","C")},12:function(t){n.INCr(t,"C")},13:function(t){n.DECr(t,"C")},14:function(t){n.LDrn(t,"C")},15:function(t){var n=1&t.r.A;t.r.F=n?16:0,t.wr("A",t.r.A>>1|128*n),t.clock.c+=4},16:function(t){t.r.pc++,t.clock.c+=4},17:function(t){n.LDrrnn(t,"D","E")},18:function(t){n.LDrrar(t,"D","E","A")},19:function(t){n.INCrr(t,"D","E")},20:function(t){n.INCr(t,"D")},21:function(t){n.DECr(t,"D")},22:function(t){n.LDrn(t,"D")},23:function(t){var n=16&t.r.F?1:0,r=128&t.r.A?1:0;t.r.F=r?16:0,t.wr("A",(t.r.A<<1)+n&255),t.clock.c+=4},24:function(t){n.JRn(t)},25:function(t){n.ADDrrrr(t,"H","L","D","E")},26:function(t){n.LDrrra(t,"A","D","E")},27:function(t){n.DECrr(t,"D","E")},28:function(t){n.INCr(t,"E")},29:function(t){n.DECr(t,"E")},30:function(t){n.LDrn(t,"E")},31:function(t){var n=16&t.r.F?1:0,r=1&t.r.A;t.r.F=r?16:0,t.wr("A",t.r.A>>1|128*n),t.clock.c+=4},32:function(t){n.JRccn(t,"NZ")},33:function(t){n.LDrrnn(t,"H","L")},34:function(t){n.LDrrar(t,"H","L","A"),n.INCrr(t,"H","L"),t.clock.c-=8},35:function(t){n.INCrr(t,"H","L")},36:function(t){n.INCr(t,"H")},37:function(t){n.DECr(t,"H")},38:function(t){n.LDrn(t,"H")},39:function(t){n.DAA(t)},40:function(t){n.JRccn(t,"Z")},41:function(t){n.ADDrrrr(t,"H","L","H","L")},42:function(t){n.LDrrra(t,"A","H","L"),n.INCrr(t,"H","L"),t.clock.c-=8},43:function(t){n.DECrr(t,"H","L")},44:function(t){n.INCr(t,"L")},45:function(t){n.DECr(t,"L")},46:function(t){n.LDrn(t,"L")},47:function(t){n.CPL(t)},48:function(t){n.JRccn(t,"NC")},49:function(t){n.LDspnn(t)},50:function(t){n.LDrrar(t,"H","L","A"),n.DECrr(t,"H","L"),t.clock.c-=8},51:function(t){n.INCsp(t)},52:function(t){n.INCrra(t,"H","L")},53:function(t){n.DECrra(t,"H","L")},54:function(t){n.LDrran(t,"H","L")},55:function(t){n.SCF(t)},56:function(t){n.JRccn(t,"C")},57:function(t){n.ADDrrsp(t,"H","L")},58:function(t){n.LDrrra(t,"A","H","L"),n.DECrr(t,"H","L"),t.clock.c-=8},59:function(t){n.DECsp(t)},60:function(t){n.INCr(t,"A")},61:function(t){n.DECr(t,"A")},62:function(t){n.LDrn(t,"A")},63:function(t){n.CCF(t)},64:function(t){n.LDrr(t,"B","B")},65:function(t){n.LDrr(t,"B","C")},66:function(t){n.LDrr(t,"B","D")},67:function(t){n.LDrr(t,"B","E")},68:function(t){n.LDrr(t,"B","H")},69:function(t){n.LDrr(t,"B","L")},70:function(t){n.LDrrra(t,"B","H","L")},71:function(t){n.LDrr(t,"B","A")},72:function(t){n.LDrr(t,"C","B")},73:function(t){n.LDrr(t,"C","C")},74:function(t){n.LDrr(t,"C","D")},75:function(t){n.LDrr(t,"C","E")},76:function(t){n.LDrr(t,"C","H")},77:function(t){n.LDrr(t,"C","L")},78:function(t){n.LDrrra(t,"C","H","L")},79:function(t){n.LDrr(t,"C","A")},80:function(t){n.LDrr(t,"D","B")},81:function(t){n.LDrr(t,"D","C")},82:function(t){n.LDrr(t,"D","D")},83:function(t){n.LDrr(t,"D","E")},84:function(t){n.LDrr(t,"D","H")},85:function(t){n.LDrr(t,"D","L")},86:function(t){n.LDrrra(t,"D","H","L")},87:function(t){n.LDrr(t,"D","A")},88:function(t){n.LDrr(t,"E","B")},89:function(t){n.LDrr(t,"E","C")},90:function(t){n.LDrr(t,"E","D")},91:function(t){n.LDrr(t,"E","E")},92:function(t){n.LDrr(t,"E","H")},93:function(t){n.LDrr(t,"E","L")},94:function(t){n.LDrrra(t,"E","H","L")},95:function(t){n.LDrr(t,"E","A")},96:function(t){n.LDrr(t,"H","B")},97:function(t){n.LDrr(t,"H","C")},98:function(t){n.LDrr(t,"H","D")},99:function(t){n.LDrr(t,"H","E")},100:function(t){n.LDrr(t,"H","H")},101:function(t){n.LDrr(t,"H","L")},102:function(t){n.LDrrra(t,"H","H","L")},103:function(t){n.LDrr(t,"H","A")},104:function(t){n.LDrr(t,"L","B")},105:function(t){n.LDrr(t,"L","C")},106:function(t){n.LDrr(t,"L","D")},107:function(t){n.LDrr(t,"L","E")},108:function(t){n.LDrr(t,"L","H")},109:function(t){n.LDrr(t,"L","L")},110:function(t){n.LDrrra(t,"L","H","L")},111:function(t){n.LDrr(t,"L","A")},112:function(t){n.LDrrar(t,"H","L","B")},113:function(t){n.LDrrar(t,"H","L","C")},114:function(t){n.LDrrar(t,"H","L","D")},115:function(t){n.LDrrar(t,"H","L","E")},116:function(t){n.LDrrar(t,"H","L","H")},117:function(t){n.LDrrar(t,"H","L","L")},118:function(t){n.HALT(t)},119:function(t){n.LDrrar(t,"H","L","A")},120:function(t){n.LDrr(t,"A","B")},121:function(t){n.LDrr(t,"A","C")},122:function(t){n.LDrr(t,"A","D")},123:function(t){n.LDrr(t,"A","E")},124:function(t){n.LDrr(t,"A","H")},125:function(t){n.LDrr(t,"A","L")},126:function(t){n.LDrrra(t,"A","H","L")},127:function(t){n.LDrr(t,"A","A")},128:function(t){n.ADDrr(t,"A","B")},129:function(t){n.ADDrr(t,"A","C")},130:function(t){n.ADDrr(t,"A","D")},131:function(t){n.ADDrr(t,"A","E")},132:function(t){n.ADDrr(t,"A","H")},133:function(t){n.ADDrr(t,"A","L")},134:function(t){n.ADDrrra(t,"A","H","L")},135:function(t){n.ADDrr(t,"A","A")},136:function(t){n.ADCrr(t,"A","B")},137:function(t){n.ADCrr(t,"A","C")},138:function(t){n.ADCrr(t,"A","D")},139:function(t){n.ADCrr(t,"A","E")},140:function(t){n.ADCrr(t,"A","H")},141:function(t){n.ADCrr(t,"A","L")},142:function(t){n.ADCrrra(t,"A","H","L")},143:function(t){n.ADCrr(t,"A","A")},144:function(t){n.SUBr(t,"B")},145:function(t){n.SUBr(t,"C")},146:function(t){n.SUBr(t,"D")},147:function(t){n.SUBr(t,"E")},148:function(t){n.SUBr(t,"H")},149:function(t){n.SUBr(t,"L")},150:function(t){n.SUBrra(t,"H","L")},151:function(t){n.SUBr(t,"A")},152:function(t){n.SBCr(t,"B")},153:function(t){n.SBCr(t,"C")},154:function(t){n.SBCr(t,"D")},155:function(t){n.SBCr(t,"E")},156:function(t){n.SBCr(t,"H")},157:function(t){n.SBCr(t,"L")},158:function(t){n.SBCrra(t,"H","L")},159:function(t){n.SBCr(t,"A")},160:function(t){n.ANDr(t,"B")},161:function(t){n.ANDr(t,"C")},162:function(t){n.ANDr(t,"D")},163:function(t){n.ANDr(t,"E")},164:function(t){n.ANDr(t,"H")},165:function(t){n.ANDr(t,"L")},166:function(t){n.ANDrra(t,"H","L")},167:function(t){n.ANDr(t,"A")},168:function(t){n.XORr(t,"B")},169:function(t){n.XORr(t,"C")},170:function(t){n.XORr(t,"D")},171:function(t){n.XORr(t,"E")},172:function(t){n.XORr(t,"H")},173:function(t){n.XORr(t,"L")},174:function(t){n.XORrra(t,"H","L")},175:function(t){n.XORr(t,"A")},176:function(t){n.ORr(t,"B")},177:function(t){n.ORr(t,"C")},178:function(t){n.ORr(t,"D")},179:function(t){n.ORr(t,"E")},180:function(t){n.ORr(t,"H")},181:function(t){n.ORr(t,"L")},182:function(t){n.ORrra(t,"H","L")},183:function(t){n.ORr(t,"A")},184:function(t){n.CPr(t,"B")},185:function(t){n.CPr(t,"C")},186:function(t){n.CPr(t,"D")},187:function(t){n.CPr(t,"E")},188:function(t){n.CPr(t,"H")},189:function(t){n.CPr(t,"L")},190:function(t){n.CPrra(t,"H","L")},191:function(t){n.CPr(t,"A")},192:function(t){n.RETcc(t,"NZ")},193:function(t){n.POPrr(t,"B","C")},194:function(t){n.JPccnn(t,"NZ")},195:function(t){n.JPnn(t)},196:function(t){n.CALLccnn(t,"NZ")},197:function(t){n.PUSHrr(t,"B","C")},198:function(t){n.ADDrn(t,"A")},199:function(t){n.RSTn(t,0)},200:function(t){n.RETcc(t,"Z")},201:function(t){n.RET(t)},202:function(t){n.JPccnn(t,"Z")},203:function(t){n.CB(t)},204:function(t){n.CALLccnn(t,"Z")},205:function(t){n.CALLnn(t)},206:function(t){n.ADCrn(t,"A")},207:function(t){n.RSTn(t,8)},208:function(t){n.RETcc(t,"NC")},209:function(t){n.POPrr(t,"D","E")},210:function(t){n.JPccnn(t,"NC")},212:function(t){n.CALLccnn(t,"NC")},213:function(t){n.PUSHrr(t,"D","E")},214:function(t){n.SUBn(t)},215:function(t){n.RSTn(t,16)},216:function(t){n.RETcc(t,"C")},217:function(t){n.RETI(t)},218:function(t){n.JPccnn(t,"C")},220:function(t){n.CALLccnn(t,"C")},222:function(t){n.SBCn(t)},223:function(t){n.RSTn(t,24)},224:function(t){n.LDHnar(t,"A")},225:function(t){n.POPrr(t,"H","L")},226:function(t){n.LDrar(t,"C","A")},229:function(t){n.PUSHrr(t,"H","L")},230:function(t){n.ANDn(t)},231:function(t){n.RSTn(t,32)},232:function(t){n.ADDspn(t)},233:function(t){n.JPrr(t,"H","L")},234:function(t){n.LDnnar(t,"A")},238:function(t){n.XORn(t)},239:function(t){n.RSTn(t,40)},240:function(t){n.LDHrna(t,"A")},241:function(t){n.POPrr(t,"A","F")},242:function(t){n.LDrra(t,"A","C")},243:function(t){n.DI(t)},245:function(t){n.PUSHrr(t,"A","F")},246:function(t){n.ORn(t)},247:function(t){n.RSTn(t,48)},248:function(t){n.LDrrspn(t,"H","L")},249:function(t){n.LDsprr(t,"H","L")},250:function(t){n.LDrnna(t,"A")},251:function(t){n.EI(t)},254:function(t){n.CPn(t)},255:function(t){n.RSTn(t,56)}},t.opcodeCbmap=r}(GameboyJS=GameboyJS||{}),function(t){"use strict";function n(){}n.prototype.setCallback=function(t){this.callback=t},n.prototype.loadFromUrl=function(t){if(!t)throw"No url has been set in order to load a ROM file.";var n=this.callback,r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){var t=new Uint8Array(r.response);n&&n(t)},r.send()},t.RomAjaxReader=n}(GameboyJS=GameboyJS||{}),function(t){"use strict";function n(t){if(this.dropElement=t,!this.dropElement)throw"The RomDropFileReader needs a drop zone.";var n=this;this.dropElement.addEventListener("dragenter",function(t){t.preventDefault(),t.target===n.dropElement&&n.dropElement.classList.add("drag-active")}),this.dropElement.addEventListener("dragleave",function(t){t.preventDefault(),t.target===n.dropElement&&n.dropElement.classList.remove("drag-active")}),this.dropElement.addEventListener("dragover",function(t){t.preventDefault(),n.dropElement.classList.add("drag-active")}),this.dropElement.addEventListener("drop",function(t){n.dropElement.classList.remove("drag-active"),0!=t.dataTransfer.files.length&&(t.preventDefault(),n.loadFromFile(t.dataTransfer.files[0]))})}n.prototype.setCallback=function(t){this.callback=t},n.prototype.loadFromFile=function(t){var n,r;void 0!==t&&(n=new FileReader,r=this.callback,n.onload=function(){r&&r(new Uint8Array(n.result))},n.onerror=function(t){console.log("Error reading the file",t.target.error.code)},n.readAsArrayBuffer(t))},t.RomDropFileReader=n}(GameboyJS=GameboyJS||{}),function(t){"use strict";function n(t){if(this.domElement=t||document.getElementById("file"),!this.domElement)throw"The RomFileReader needs a valid input element.";var n=this;this.domElement.addEventListener("change",function(t){n.loadFromFile(t.target.files[0])})}n.prototype.setCallback=function(t){this.callback=t},n.prototype.loadFromFile=function(t){var n,r;void 0!==t&&(n=new FileReader,r=this.callback,n.onload=function(){r&&r(new Uint8Array(n.result))},n.onerror=function(t){console.log("Error reading the file",t.target.error.code)},n.readAsArrayBuffer(t))},t.RomFileReader=n}(GameboyJS=GameboyJS||{}),function(t){"use strict";function n(t,n){this.gameboy=t,n&&this.addReader(n)}n.prototype.addReader=function(t){var n=this;t.setCallback(function(t){!function(t){for(var n=0,r=308;r<=332;r++)n=n-t[r]-1;return(255&n)==t[333]}(t)?n.gameboy.error("The file is not a valid GameBoy ROM."):(n.data=t,n.gameboy.startRom(n))})},t.Rom=n}(GameboyJS=GameboyJS||{}),function(t){"use strict";var n={current:"",timeout:null,out:function(t){n.current+=String.fromCharCode(t),10==t?n.print():(clearTimeout(n.timeout),n.timeout=setTimeout(n.print,500))},in:function(){return 255},print:function(){clearTimeout(n.timeout),console.log("serial: "+n.current),n.current=""}};t.ConsoleSerial=n;t.DummySerial={out:function(){},in:function(){return 255}}}(GameboyJS=GameboyJS||{}),function(n){"use strict";function o(t){this.memory=t,this.enabled=!1,t=new(window.AudioContext||window.webkitAudioContext),this.channel1=new n.Channel1(this,1,t),this.channel2=new n.Channel1(this,2,t),this.channel3=new n.Channel3(this,3,t),this.channel4=new n.Channel4(this,4,t)}o.prototype.connect=function(){this.channel1.enable(),this.channel2.enable(),this.channel3.enable()},o.prototype.disconnect=function(){this.channel1.disable(),this.channel2.disable(),this.channel3.disable()},o.prototype.update=function(t){0!=this.enabled&&(this.channel1.update(t),this.channel2.update(t),this.channel3.update(t),this.channel4.update(t))},o.prototype.setSoundFlag=function(t,n){var r=255-(1<<t-1),t=(n<<=t-1,this.memory.rb(o.registers.NR52));this.memory[o.registers.NR52]=t&r|n},o.prototype.manageWrite=function(t,n){if(!(0==this.enabled&&t<o.registers.NR52))switch(this.memory[t]=n,t){case 65296:this.channel1.clockSweep=0,this.channel1.sweepTime=(112&n)>>4,this.channel1.sweepSign=8&n?-1:1,this.channel1.sweepShifts=7&n,this.channel1.sweepCount=this.channel1.sweepShifts;break;case 65297:this.channel1.setLength(63&n);break;case 65298:this.channel1.envelopeSign=8&n?1:-1;var r=(240&n)>>4;this.channel1.setEnvelopeVolume(r),this.channel1.envelopeStep=7&n;break;case 65299:var i=this.channel1.getFrequency();this.channel1.setFrequency(i=i&3840|n);break;case 65300:i=this.channel1.getFrequency();this.channel1.setFrequency(i=i&255|(7&n)<<8),this.channel1.lengthCheck=!!(64&n),128&n&&this.channel1.play();break;case 65302:this.channel2.setLength(63&n);break;case 65303:this.channel2.envelopeSign=8&n?1:-1;r=(240&n)>>4;this.channel2.setEnvelopeVolume(r),this.channel2.envelopeStep=7&n;break;case 65304:i=this.channel2.getFrequency();this.channel2.setFrequency(i=i&3840|n);break;case 65305:i=this.channel2.getFrequency();this.channel2.setFrequency(i=i&255|(7&n)<<8),this.channel2.lengthCheck=!!(64&n),128&n&&this.channel2.play();break;case 65306:break;case 65307:this.channel3.setLength(n);break;case 65308:break;case 65309:i=this.channel3.getFrequency();this.channel3.setFrequency(i=i&3840|n);break;case 65310:i=this.channel3.getFrequency();this.channel3.setFrequency(i=i&255|(7&n)<<8),this.channel3.lengthCheck=!!(64&n),128&n&&this.channel3.play();break;case 65312:this.channel4.setLength(63&n);break;case 65313:case 65314:break;case 65315:this.channel4.lengthCheck=!!(64&n),128&n&&this.channel4.play();break;case 65328:case 65329:case 65330:case 65331:case 65332:case 65333:case 65334:case 65335:case 65336:case 65337:case 65338:case 65339:case 65340:case 65341:case 65342:case 65343:this.channel3.setWaveBufferByte(t-65328,n);break;case 65318:if(this.memory[t]=n&=240,this.enabled=0!=(128&n),!this.enabled)for(var e=65296;e<65319;e++)this.memory[e]=0}},o.registers={NR10:65296,NR11:65297,NR12:65298,NR13:65299,NR14:65300,NR21:65302,NR22:65303,NR23:65304,NR24:65305,NR30:65306,NR31:65307,NR32:65308,NR33:65309,NR34:65310,NR41:65312,NR42:65313,NR43:65314,NR44:65315,NR50:65316,NR51:65317,NR52:65318},n.APU=o}(GameboyJS=GameboyJS||{}),function(t){"use strict";function n(t,n,r){this.apu=t,this.channelNumber=n,this.playing=!1,this.soundLengthUnit=16384,this.soundLength=64,this.lengthCheck=!1,this.sweepTime=0,this.sweepStepLength=32768,this.sweepCount=0,this.sweepShifts=0,this.sweepSign=1,this.frequency=0,this.envelopeStep=0,this.envelopeStepLength=65536,this.envelopeCheck=!1,this.envelopeSign=1,this.clockLength=0,this.clockEnvelop=0,this.clockSweep=0,(t=r.createGain()).gain.value=0,(n=r.createOscillator()).type="square",n.frequency.value=1e3,n.connect(t),n.start(0),this.audioContext=r,this.gainNode=t,this.oscillator=n}n.prototype.play=function(){this.playing||(this.playing=!0,this.apu.setSoundFlag(this.channelNumber,1),this.gainNode.connect(this.audioContext.destination),this.clockLength=0,this.clockEnvelop=0,(this.clockSweep=0)<this.sweepShifts&&this.checkFreqSweep())},n.prototype.stop=function(){this.playing=!1,this.apu.setSoundFlag(this.channelNumber,0),this.gainNode.disconnect()},n.prototype.checkFreqSweep=function(){var t=this.getFrequency(),t=t+this.sweepSign*(t>>this.sweepShifts);return 2047<t&&(t=0,this.stop()),t},n.prototype.update=function(t){var n;this.clockEnvelop+=t,this.clockSweep+=t,(this.sweepCount||this.sweepTime)&&this.clockSweep>this.sweepStepLength*this.sweepTime&&(this.clockSweep-=this.sweepStepLength*this.sweepTime,this.sweepCount--,n=this.checkFreqSweep(),this.apu.memory[65299]=255&n,this.apu.memory[65300]&=248,this.apu.memory[65300]|=(1792&n)>>8,this.setFrequency(n),this.checkFreqSweep()),this.envelopeCheck&&this.clockEnvelop>this.envelopeStepLength&&(this.clockEnvelop-=this.envelopeStepLength,this.envelopeStep--,this.setEnvelopeVolume(this.envelopeVolume+this.envelopeSign),this.envelopeStep<=0)&&(this.envelopeCheck=!1),this.lengthCheck&&(this.clockLength+=t,this.clockLength>this.soundLengthUnit)&&(this.soundLength--,this.clockLength-=this.soundLengthUnit,0==this.soundLength)&&(this.setLength(0),this.stop())},n.prototype.setFrequency=function(t){this.frequency=t,this.oscillator.frequency.value=131072/(2048-this.frequency)},n.prototype.getFrequency=function(){return this.frequency},n.prototype.setLength=function(t){this.soundLength=64-(63&t)},n.prototype.setEnvelopeVolume=function(t){this.envelopeCheck=0<t&&t<16,this.envelopeVolume=t,this.gainNode.gain.value=+this.envelopeVolume/100},n.prototype.disable=function(){this.oscillator.disconnect()},n.prototype.enable=function(){this.oscillator.connect(this.gainNode)},t.Channel1=n}(GameboyJS=GameboyJS||{}),function(t){"use strict";function n(t,n,r){this.apu=t,this.channelNumber=n,this.playing=!1,this.soundLength=0,this.soundLengthUnit=16384,this.lengthCheck=!1,this.clockLength=0,this.buffer=new Float32Array(32);(t=r.createGain()).gain.value=1,this.gainNode=t,this.baseSpeed=65536;var n=r.createBuffer(1,32,this.baseSpeed),i=r.createBufferSource();i.buffer=n,i.loop=!0,i.connect(t),i.start(0),this.audioContext=r,this.waveBuffer=n,this.bufferSource=i}n.prototype.play=function(){this.playing||(this.playing=!0,this.apu.setSoundFlag(this.channelNumber,1),this.waveBuffer.copyToChannel(this.buffer,0,0),this.gainNode.connect(this.audioContext.destination),this.clockLength=0)},n.prototype.stop=function(){this.playing=!1,this.apu.setSoundFlag(this.channelNumber,0),this.gainNode.disconnect()},n.prototype.update=function(t){this.lengthCheck&&(this.clockLength+=t,this.clockLength>this.soundLengthUnit)&&(this.soundLength--,this.clockLength-=this.soundLengthUnit,0==this.soundLength)&&(this.setLength(0),this.stop())},n.prototype.setFrequency=function(t){this.bufferSource.playbackRate.value=(t=65536/(2048-t))/this.baseSpeed},n.prototype.getFrequency=function(){return 1|2048-65536/(this.bufferSource.playbackRate.value*this.baseSpeed)},n.prototype.setLength=function(t){this.soundLength=256-t},n.prototype.setWaveBufferByte=function(t,n){t*=2;this.buffer[t]=(n>>4)/8-1,this.buffer[1+t]=(15&n)/8-1},n.prototype.disable=function(){this.bufferSource.disconnect()},n.prototype.enable=function(){this.bufferSource.connect(this.gainNode)},t.Channel3=n}(GameboyJS=GameboyJS||{}),function(t){"use strict";function n(t,n,r){this.apu=t,this.channelNumber=n,this.playing=!1,this.soundLengthUnit=16384,this.soundLength=64,this.lengthCheck=!1,this.clockLength=0,this.audioContext=r}n.prototype.play=function(){this.playing||(this.playing=!0,this.apu.setSoundFlag(this.channelNumber,1),this.clockLength=0)},n.prototype.stop=function(){this.playing=!1,this.apu.setSoundFlag(this.channelNumber,0)},n.prototype.update=function(t){this.lengthCheck&&(this.clockLength+=t,this.clockLength>this.soundLengthUnit)&&(this.soundLength--,this.clockLength-=this.soundLengthUnit,0==this.soundLength)&&(this.setLength(0),this.stop())},n.prototype.setLength=function(t){this.soundLength=64-(63&t)},t.Channel4=n}(GameboyJS=GameboyJS||{}),function(r){"use strict";function t(t,n){this.cpu=t,this.memory=n,this.DIV=65284,this.TIMA=65285,this.TMA=65286,this.TAC=65287,this.mainTime=0,this.divTime=0}t.prototype.update=function(t){this.updateDiv(t),this.updateTimer(t)},t.prototype.updateTimer=function(t){if(4&this.memory.rb(this.TAC)){this.mainTime+=t;var n=64;switch(3&this.memory.rb(this.TAC)){case 0:n=64;break;case 1:n=1;break;case 2:n=4;break;case 3:n=16}for(n*=16;this.mainTime>=n;)this.mainTime-=n,this.memory.wb(this.TIMA,this.memory.rb(this.TIMA)+1),255<this.memory.rb(this.TIMA)&&(this.memory.wb(this.TIMA,this.memory.rb(this.TMA)),this.cpu.requestInterrupt(r.CPU.INTERRUPTS.TIMER))}},t.prototype.updateDiv=function(t){this.divTime+=t,256<this.divTime&&(this.divTime-=256,t=this.memory.rb(this.DIV)+1,this.memory.wb(this.DIV,255&t))},t.prototype.resetDiv=function(){this.divTime=0,this.memory[this.DIV]=0},r.Timer=t}(GameboyJS=GameboyJS||{}),function(t){"use strict";var i={extend:function(t){var n,r=Array.prototype.slice.call(arguments);for(n in r){var i,e=r[n];for(i in e)t[i]=e[i]}return t},testFlag:function(t,n){var r=1,i="NZ"!=n&&"Z"!=n?16:128;return(r="NZ"!=n&&"NC"!=n?r:0)&&t.r.F&i||!r&&!(t.r.F&i)},getRegAddr:function(t,n,r){return i.makeword(t.r[n],t.r[r])},makeword:function(t,n){return(t<<8)+n},getSignedValue:function(t){return 128&t?t-256:t},readBit:function(t,n){return t>>n&1}};t.Util=i}(GameboyJS=GameboyJS||{});